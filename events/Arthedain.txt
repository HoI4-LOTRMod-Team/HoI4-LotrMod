###########################
# Arthedain Events
###########################

add_namespace = arthedain


# Arthedain asks about Mutual Defense Pact
country_event = {
	id = arthedain.1
	title = arthedain.1.t
	desc = arthedain.1.d
	picture = GFX_report_event_paper
	
	is_triggered_only = yes
	
	option = { #Accept
		name = arthedain.1.a
		ai_chance = {
			base = 60
		}
		ART = { give_guarantee = PREV }
		THIS = { give_guarantee = ART }
	}
	option = { #Refuse
		name = arthedain.1.b
		ai_chance = {
			base = 50
			modifier = {
				add = 5000
				has_war_with = ART
			}
		}
	}
}

# Demand Cardolan / Rhudaur
country_event = {
	id = arthedain.2
	title = arthedain.2.t
	desc = arthedain.2.d
	picture = GFX_report_event_paper

	is_triggered_only = yes

	option = { # Accept
		name = arthedain.2.a
		ai_chance = {
			base = 15
			modifier = {
				add = 10
				THIS = { has_government = belligerent }
			}
			modifier = {
				has_opinion = { target = ART value > 50 }
				add = 30
			}
			modifier = {
				add = 15
				FROM = { has_idea_with_trait = arnor_unification_advocate }
			}
			modifier = {
				add = -999
				is_puppet = yes
			}
		}
 		ART = { annex_country = { target = PREV } }
	}
	option = { # Refuse
		name = arthedain.2.b
		ai_chance = {
			base = 50
			modifier = {
				any_other_country = {
					has_guaranteed = THIS
				}
				factor = 5
			}
			modifier = {
				add = 30
				strength_ratio = { tag = ART ratio > 0.5 }
			}
			modifier = {
				add = 100
				is_in_faction = yes
			}
			modifier = {
				add = 500
				strength_ratio = { tag = ART ratio > 1.0 }
			}
		}
		ART = { create_wargoal = { type = annex_everything target = PREV }  }
	}
}

# Asked to join Arnor Coalition
country_event = {
	id = arthedain.3
	title = arthedain.3.t
	desc = arthedain.3.d
	picture = GFX_report_event_elven_alliance
	
	is_triggered_only = yes
	
	option = { #Accept
		name = arthedain.3.a
		ai_chance = {
			base = 60
			modifier = {
				add = 30
				FROM = { has_idea_with_trait = arnor_unification_advocate }
			}
		}
		ART = { add_to_faction = PREV }
	}
	option = { #Refuse
		name = arthedain.3.b
		ai_chance = {
			base = 30
			modifier = {
				add = 5000
				has_government = belligerent
			}
			modifier = {
				add = 5000
				has_government = revolutionary
			}
			modifier = {
				add = 300
				is_in_faction = yes
			}
		}
	}
}

# Asked to reform Kingdom of Arnor
country_event = {
	id = arthedain.4
	title = arthedain.4.t
	desc = arthedain.4.d
	picture = GFX_report_event_paper
	
	is_triggered_only = yes
	
	option = { #Accept
		name = arthedain.4.a
		ai_chance = {
			base = 10
			modifier = {
				add = 30
				is_in_faction_with = ART
			}
			modifier = {
				add = 30
				has_government = cooperative
			}
			modifier = {
				has_opinion = { target = ART value > 50 }
				add = 30
			}
			modifier = {
				has_opinion = { target = ART value > 90 }
				add = 20
			}
			modifier = {
				has_country_flag = arthedain_reformation_encouraged
				add = 30
			}
			modifier = {
				add = 30
				FROM = { has_idea_with_trait = arnor_unification_advocate }
			}
			modifier = {
				add = 30
				is_puppet_of = ART
			}
		}
		every_owned_state = {
			limit = { is_core_of = ROOT }
			add_core_of = ART
		}
		ART = { annex_country = { target = PREV transfer_troops = yes }  }
	}
	option = { #Refuse
		name = arthedain.4.b
		ai_chance = {
			base = 50
			modifier = {
				add = 5000
				has_government = belligerent
			}
			modifier = {
				add = 5000
				has_government = revolutionary
			}
			modifier = {
				has_opinion = { target = ART value < 0 }
				add = 50
			}
		}
	}
}

# Arthedain asks to reunite with Gondor
country_event = {
	id = arthedain.5
	title = arthedain.5.t
	desc = arthedain.5.d
	picture = GFX_report_event_paper
	
	is_triggered_only = yes
	
	option = { #Accept
		name = arthedain.5.a
		ai_chance = {
			base = 60
		}
		ART = {
			dismantle_faction = yes
			add_stability = 0.10
		}
		GON = {
			add_to_faction = ART
			add_stability = 0.10
		}
	}
	option = { #Refuse
		name = arthedain.5.b
		ai_chance = {
			base = 15
		}
		add_political_power = -100
		add_stability = -0.10
	}
}

# Request to form the 'Grey Company'
country_event = {
	id = arthedain.6
	title = arthedain.6.t
	desc = arthedain.6.d
	picture = GFX_report_event_rangers
	
	is_triggered_only = yes

	trigger = {
		NOT = { has_global_flag = grey_company_formed }
	}
	
	option = { #Accept
		name = arthedain.6.a
		ai_chance = {
			base = 6
			modifier = {
				factor = 2
				has_opinion = {
					target = ART
					value > 30
				}
			}
			modifier = {
				factor = 5
				ART = { is_going_same_path_as_root = yes }
			}
			modifier = {
				factor = 0.25
				ART = { is_going_different_path_as_root = yes }
			}
			modifier = {
				factor = 5
				OR = {
					tag = ART
					tag = RHD
				}
			}
		}

		add_equipment_to_stockpile = {
			type = infantry_equipment
			amount = -800
		}
		add_timed_idea = {
			idea = minor_expense
			days = 80
		}

		custom_effect_tooltip = arthedain.6.a_tt

		hidden_effect = {
			if = {
				limit = { NOT = { has_variable = global.grey_company_supporters } }
				set_variable = { global.grey_company_supporters = 1 } # We start at 1 because whoever triggered the event/took the focus auto-support this
			}
			add_to_variable = { global.grey_company_supporters = 1 }

			if = {
				limit = {
					check_variable = { global.grey_company_supporters > 2 }
					NOT = { has_global_flag = grey_company_formed }
				}
				set_global_flag = grey_company_formed
				ART = { country_event = { id = arthedain.7 days = 12 } }
				RHD = { country_event = { id = arthedain.7 days = 12 } }
			}
		}
		
	}
	option = { #Refuse
		name = arthedain.6.b
		
		ai_chance = {
			base = 2
			modifier = {
				factor = 3
				has_opinion = {
					target = ART
					value < 0
				}
			}
			modifier = {
				factor = 3
				ART = { is_going_different_path_as_root = yes }
			}
			modifier = {
				factor = 0.25
				OR = {
					tag = ART
					tag = RHD
				}
			}
		}
	}
}

# Grey Company Formed
country_event = {
	id = arthedain.7
	title = arthedain.7.t
	desc = arthedain.7.d
	picture = GFX_report_event_rangers
	
	is_triggered_only = yes
	
	option = { #Accept
		name = arthedain.7.a
		ai_chance = {
			base = 60
		}
		if = {
			limit = { tag = ART }
			load_oob = ART_GreyCompany
		}
		else_if = {
			limit = { tag = RHD }
			load_oob = RHD_GreyCompany
		}
	}
}

# Gondor invites Arthedain to faction
country_event = {
	id = arthedain.8
	title = arthedain.8.t
	desc = arthedain.8.d
	picture = GFX_report_event_gondor
	
	is_triggered_only = yes
	
	option = { #Accept
		name = arthedain.8.a
		ai_chance = {
			base = 15
			modifier = {
				factor = 2
				GON = { has_same_ideology = yes }
			}
		}
		ART = {
			dismantle_faction = yes
			add_stability = 0.10
		}
		GON = {
			add_to_faction = ART
			add_stability = 0.10
		}
	}
	option = { #Refuse
		name = arthedain.8.b
		ai_chance = {
			base = 15
			modifier = {
				factor = 2
				has_war = no
				GON = { has_war = yes }
			}
			modifier = {
				factor = 5
				has_government = belligerent
				has_government = revolutionary
			}
			modifier = {
				factor = 2
				GON = { is_weaker = yes }
			}
			modifier = {
				factor = 2
				GON = { is_significantly_weaker = yes }
			}
		}
		GON = {
			add_opinion_modifier = { target = ART modifier = medium_increase }
		}
		add_political_power = -100
		add_stability = -0.05
	}
}

# Gondor demands Arthedain become part of Gondor once more
country_event = {
	id = arthedain.9
	title = arthedain.9.t
	desc = arthedain.9.d
	picture = GFX_report_event_gondor
	
	is_triggered_only = yes
	
	option = { #Accept
		name = arthedain.9.a
		ai_chance = {
			base = 15
			modifier = {
				factor = 2
				GON = { has_same_ideology = yes }
			}
		}
		GON = {
			set_autonomy = {
				target = ART
				autonomy_state = autonomy_fiefdom
			}
		}
	}
	option = { #Refuse
		name = arthedain.9.b
		ai_chance = {
			base = 15
			modifier = {
				factor = 2
				has_war = no
				GON = { has_war = yes }
			}
			modifier = {
				factor = 5
				has_government = belligerent
				has_government = revolutionary
			}
			modifier = {
				factor = 2
				GON = { is_weaker = yes }
			}
			modifier = {
				factor = 2
				GON = { is_significantly_weaker = yes }
			}
		}
		GON = {
			add_opinion_modifier = { target = ART modifier = medium_increase }
			create_wargoal = { type = puppet_wargoal_focus target = ART }
		}
		add_political_power = -100
		add_stability = -0.05
	}
}