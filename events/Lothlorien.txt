###########################
# Lorien Events
###########################

add_namespace = lothlorien


# Lorien asks jo join Gondor Faction
country_event = {
	id = lothlorien.1
	title = lothlorien.1.t
	desc = lothlorien.1.d
	picture = GFX_report_event_alliance
	
	is_triggered_only = yes
	
	option = { #Accept
		name = lothlorien.1.a
		ai_chance = {
			base = 60
			modifier = {
				add = 40
				GON = { has_war = yes }
			}
		}
		GON = { add_to_faction = LTH }
	}
	option = { #Refuse
		name = lothlorien.1.b
		ai_chance = {
			base = 30
			modifier = {
				add = 5000
				GON = { has_government = belligerent }
			}
			modifier = {
				add = 20
				GON = { has_government = unaligned }
			}
			modifier = {
				add = 10
				LTH = { has_war = yes }
			}
		}
	}
}

# Offer shelter to fellowship
country_event = {
	id = lothlorien.3
	title = lothlorien.3.t
	desc = lothlorien.3.d
	fire_only_once = yes

	is_triggered_only = yes

	option = {
		ai_chance = {base = 6}
		name = lothlorien.3.a

		ring_rivendell_approves = yes

		set_global_flag = LTH_offered_shelter
		LTH = {complete_national_focus = offersheltertothefellowship}

		# delay the fellowship leaving
		add_to_variable = { global.fs_days_left_in_state = 30 }

		# give choice to take the ring after a while
		hidden_effect = {
			LTH = { country_event = { days = 7 id = lothlorien.2 } }

			ring_heal_fellowship = yes

			add_to_array = { global.fs_eventlog_prefix_targets = 0 }
			add_to_array = { global.fs_eventlog_suffix_targets = 0 }
			add_to_array = { global.fs_eventlog = token:fs_event_lth_give_shelter }
			ring_trim_eventlog = yes
		}
	}
	option = {
		ai_chance = {
			base = 1 
			modifier = {is_historical_focus_on = yes factor = 0}
		}
		name = lothlorien.3.b

		ring_rivendell_disapproves = yes

		hidden_effect = {
			add_to_array = { global.fs_eventlog_prefix_targets = 0 }
			add_to_array = { global.fs_eventlog_suffix_targets = 0 }
			add_to_array = { global.fs_eventlog = token:fs_event_lth_refuse_shelter }
			ring_trim_eventlog = yes
		}
	}
}

# Take ring?
country_event = {
	id = lothlorien.2
	title = lothlorien.2.t
	desc = lothlorien.2.d
	fire_only_once = yes
	picture = GFX_report_event_ring
	
	is_triggered_only = yes

	# take it
	option = {
		name = lothlorien.2.a
		ai_chance = {
			base = 3
			modifier = {
				OR = {
					has_completed_focus = victorythroughstrength
					has_completed_focus = victorythroughsubmission
					has_completed_focus = victorythroughequity
				}
				add = 10
			}
			modifier = { is_historical_focus_on = yes factor = 0 }
		}

		ring_rivendell_disapproves = yes

		add_political_power = -250

		LTH = {complete_national_focus = taketheringfromfrodo}

		random_list = {

			# Frodo offers the ring up willingly
			5 = {
				LTH = { country_event = { days = 7 id = lothlorien.4 } }
			}
			# Frodo refuses
			95 = {
				LTH = { country_event = { days = 7 id = lothlorien.5 } }
			}
		}

		custom_effect_tooltip = lothlorien.2.a.tt
	}
	# dont
	option = {
		name = lothlorien.2.b # gear up fellowship
		ai_chance = {
			base = 5
		}

		ring_rivendell_approves = yes
		
		LTH = { country_event = { days = 7 id = lothlorien.6 } }
	}
	
}

# Frodo gives ring
country_event = {
	id = lothlorien.4
	title = lothlorien.4.t
	desc = lothlorien.4.d
	fire_only_once = yes

	is_triggered_only = yes

	option = {
		ai_chance = { base = 1 }
		name = lothlorien.4.a

		hidden_effect = {
			news_event = { hours = 12 id = news.371 }
			ring_seize_ring = yes

			add_to_array = { global.fs_eventlog_prefix_targets = 0 }
			add_to_array = { global.fs_eventlog_suffix_targets = 0 }
			add_to_array = { global.fs_eventlog = token:fs_event_lth_frodo_gives_ring }
			ring_trim_eventlog = yes
		}
	}
}

# Frodo refuses
country_event = {
	id = lothlorien.5
	title = lothlorien.5.t
	desc = lothlorien.5.d
	fire_only_once = yes

	is_triggered_only = yes

	# Escalate
	option = {
		ai_chance = {
			base = 1
			modifier = {
				OR = {
					has_completed_focus = victorythroughstrength
					has_completed_focus = victorythroughsubmission
					has_completed_focus = victorythroughequity
				}
				add = 10
			}
		}
		name = lothlorien.5.a

		custom_effect_tooltip = lothlorien.5.a.tt

		ring_rivendell_disapproves = yes

		hidden_effect = {
			add_to_array = { global.fs_eventlog_prefix_targets = 0 }
			add_to_array = { global.fs_eventlog_suffix_targets = 0 }
			add_to_array = { global.fs_eventlog = token:fs_event_lth_frodo_refuses }
			ring_trim_eventlog = yes

			add_to_array = { global.fs_eventlog_prefix_targets = 0 }
			add_to_array = { global.fs_eventlog_suffix_targets = 0 }
			add_to_array = { global.fs_eventlog = token:fs_event_lth_frodo_refuses_escalate }
			ring_trim_eventlog = yes

			ring_open_interception_attempt_prompt = yes
		}
	}
	# Doesnt matter
	option = {
		ai_chance = { base = 2 }
		name = lothlorien.5.b

		custom_effect_tooltip = lothlorien.5.b.tt

		ring_rivendell_approves = yes

		hidden_effect = {
			add_to_array = { global.fs_eventlog_prefix_targets = 0 }
			add_to_array = { global.fs_eventlog_suffix_targets = 0 }
			add_to_array = { global.fs_eventlog = token:fs_event_lth_frodo_refuses }
			ring_trim_eventlog = yes
		}

		LTH = { country_event = { days = 2 id = lothlorien.6 } }
	}
}

# Gear up fellowship
country_event = {
	id = lothlorien.6
	title = lothlorien.6.t
	desc = lothlorien.6.d
	fire_only_once = yes

	is_triggered_only = yes

	# Gifts
	option = {
		ai_chance = {
			base = 1
		}
		name = lothlorien.6.a

		custom_effect_tooltip = lothlorien.6.a.tt

		add_timed_idea = {
    		idea = minor_expense
    		days = 180
		}

		hidden_effect = {
			# Increase attack level of all by 1
			SHI = {
				for_each_scope_loop = {
					array = global.fs_members

					THIS = { add_attack = 1 }
				}
			}

			add_to_array = { global.fs_eventlog_prefix_targets = 0 }
			add_to_array = { global.fs_eventlog_suffix_targets = 0 }
			add_to_array = { global.fs_eventlog = token:fs_event_lth_gifts }
			ring_trim_eventlog = yes
		}
	}

	# Haldir
	option = {
		ai_chance = {
			base = 1
			modifier = { is_historical_focus_on = yes factor = 0 }
		}
		name = lothlorien.6.b

		custom_effect_tooltip = lothlorien.6.b.tt

		LTH_haldir = { retire = yes }
		hidden_effect = {
			add_to_array = { global.fs_eventlog_prefix_targets = 0 }
			add_to_array = { global.fs_eventlog_suffix_targets = 0 }
			add_to_array = { global.fs_eventlog = token:fs_event_lth_haldir }
			ring_trim_eventlog = yes

			SHI = { FS_haldir = { ring_add_member_to_fellowship = yes } }
		}
	}

	# Nothing
	option = {
		ai_chance = {
			base = 1
			modifier = { is_historical_focus_on = yes factor = 0 }
		}
		name = lothlorien.6.c

		ring_rivendell_disapproves = yes
	}
}

# Schism: Public Celebrations
country_event = {
	id = lothlorien.7
	title = lothlorien.7.t
	desc = lothlorien.7.d
	fire_only_once = yes

	is_triggered_only = yes

	# Have Gala give a speech
	option = {
		ai_chance = {
			base = 1
		}
		name = lothlorien.7.a

		# TODO
	}

	# Have Cele give a speech
	option = {
		ai_chance = {
			base = 1
		}
		name = lothlorien.7.b

		# TODO
	}

	# Pick out a random person
	option = {
		ai_chance = {
			base = 1
		}
		name = lothlorien.7.c

		# TODO
	}

	# No speeches
	option = {
		ai_chance = {
			base = 1
		}
		name = lothlorien.7.d

		# TODO
	}
}

# Schism: Consult elves
country_event = {
	id = lothlorien.8
	title = lothlorien.8.t
	desc = lothlorien.8.d
	fire_only_once = yes

	is_triggered_only = yes

	# Support Gala
	option = {
		ai_chance = {
			base = 1
		}
		name = lothlorien.8.a

		# TODO
	}

	# Support Cele
	option = {
		ai_chance = {
			base = 1
		}
		name = lothlorien.8.b

		# TODO
	}

	# Abstain
	option = {
		ai_chance = {
			base = 1
		}
		name = lothlorien.8.c

		# TODO
	}
}

# Aid to Helm's deep
country_event = {
	id = lothlorien.9
	title = lothlorien.9.t
	desc = lothlorien.9.d
	fire_only_once = yes

	is_triggered_only = yes

	# Thanks
	option = {
		ai_chance = {
			base = 1
		}
		name = lothlorien.9.a

		# TODO
	}
}

# Aid to Minas Tirith
country_event = {
	id = lothlorien.10
	title = lothlorien.10.t
	desc = lothlorien.10.d
	fire_only_once = yes

	is_triggered_only = yes

	# Thanks
	option = {
		ai_chance = {
			base = 1
		}
		name = lothlorien.10.a

		# TODO
	}
}

# Commemorate Gondolin
country_event = {
	id = lothlorien.11
	title = lothlorien.11.t
	desc = lothlorien.11.d
	fire_only_once = yes

	is_triggered_only = yes

	# As an epic battle
	option = {
		ai_chance = {
			base = 1
		}
		name = lothlorien.11.a

		# Increase attack and breakthrough bonus by 5%
	}

	# As a tragedy to be rebuilt
	option = {
		ai_chance = {
			base = 1
		}
		name = lothlorien.11.b

		# Increase factory output bonus by 10%
	}
}

# Affiliate with Lindon
country_event = {
	id = lothlorien.12
	title = lothlorien.12.t
	desc = lothlorien.12.d
	fire_only_once = yes

	is_triggered_only = yes

	# Remind them that the sindar owe their longevity to their hard work and dedication
	option = {
		ai_chance = {
			base = 1
		}
		name = lothlorien.12.a

		# Increase sindar construction speed bonus

		set_global_flag = {
			flag = lothlorien_12_response_a
			days = 60
		}

		LTH = { country_event = { id = lothlorien.13 days = 7 } }
	}

	# Remind them of the humility of the elves of Doriath
	option = {
		ai_chance = {
			base = 1
		}
		name = lothlorien.12.b

		# Increase sindar supply bonus

		set_global_flag = {
			flag = lothlorien_12_response_b
			days = 60
		}

		LTH = { country_event = { id = lothlorien.13 days = 7 } }
	}

	# Remind them of the great Wisdom of Elu Thingol and Melian
	option = {
		ai_chance = {
			base = 1
		}
		name = lothlorien.12.c

		# Increase sindar research

		set_global_flag = {
			flag = lothlorien_12_response_c
			days = 60
		}

		LTH = { country_event = { id = lothlorien.13 days = 7 } }
	}
}

# Affiliate with Lindon - Response
country_event = {
	id = lothlorien.13
	title = lothlorien.13.t
	desc = lothlorien.13.d
	fire_only_once = yes

	is_triggered_only = yes

	# Remind them that the sindar owe their longevity to their hard work and dedication
	option = {
		ai_chance = {
			base = 1
		}
		trigger = {
			has_global_flag = lothlorien_12_response_a
		}
		name = lothlorien.13.a

		# Increase sindar construction speed bonus
	}

	# Remind them of the humility of the elves of Doriath
	option = {
		ai_chance = {
			base = 1
		}
		trigger = {
			has_global_flag = lothlorien_12_response_b
		}
		name = lothlorien.13.b

		# Increase sindar supply bonus
	}

	# Remind them of the great Wisdom of Elu Thingol and Melian
	option = {
		ai_chance = {
			base = 1
		}
		trigger = {
			has_global_flag = lothlorien_12_response_c
		}
		name = lothlorien.13.c

		# Increase sindar research
	}
}

# elrosofnumenor - event to gondor
country_event = {
	id = lothlorien.14
	title = lothlorien.14.t
	desc = lothlorien.14.d
	fire_only_once = yes

	is_triggered_only = yes

	# Remind them of the great warriors the numenorians were
	option = {
		ai_chance = {
			base = 1
		}
		name = lothlorien.14.a

		# Increase half-elf army xp

		set_global_flag = {
			flag = lothlorien_14_response_a
			days = 60
		}

		LTH = { country_event = { id = lothlorien.15 days = 7 } }
	}

	# Give general support
	option = {
		ai_chance = {
			base = 1
		}
		name = lothlorien.14.b

		# Give PP

		set_global_flag = {
			flag = lothlorien_14_response_b
			days = 60
		}

		LTH = { country_event = { id = lothlorien.15 days = 7 } }
	}
}

# elrosofnumenor - event to gondor - response
country_event = {
	id = lothlorien.15
	title = lothlorien.15.t
	desc = lothlorien.15.d
	fire_only_once = yes

	is_triggered_only = yes

	# Find an old tome of war-stories and send it to them
	option = {
		ai_chance = {
			base = 1
		}
		trigger = {
			has_global_flag = lothlorien_14_response_a
		}
		name = lothlorien.15.a

		# Increase half-elf army xp
	}

	# Give their messengers common curesies, then send them back
	option = {
		ai_chance = {
			base = 1
		}
		trigger = {
			has_global_flag = lothlorien_14_response_b
		}
		name = lothlorien.15.b

		# Give PP
	}
}

# elrondtheperedhil - event to rivendell
country_event = {
	id = lothlorien.16
	title = lothlorien.16.t
	desc = lothlorien.16.d
	fire_only_once = yes

	is_triggered_only = yes

	# Be humbled, full support. Speat at length with the delegation
	option = {
		ai_chance = {
			base = 1
		}
		name = lothlorien.16.a

		# Increase stability and consumer goods bonus, cost PP

		set_global_flag = {
			flag = lothlorien_16_response_a
			days = 60
		}

		LTH = { country_event = { id = lothlorien.17 days = 7 } }
	}

	# The delegation is welcome to speak with our more experienced warriors. Elrond is too busy
	option = {
		ai_chance = {
			base = 1
		}
		name = lothlorien.16.b

		# Increase army xp

		set_global_flag = {
			flag = lothlorien_16_response_b
			days = 60
		}

		LTH = { country_event = { id = lothlorien.17 days = 7 } }
	}
}

# elrondtheperedhil - event to rivendell
country_event = {
	id = lothlorien.17
	title = lothlorien.17.t
	desc = lothlorien.17.d
	fire_only_once = yes

	is_triggered_only = yes

	# Be humbled, full support. Speat at length with the delegation
	option = {
		ai_chance = {
			base = 1
		}
		trigger = {
			has_global_flag = lothlorien_16_response_a
		}
		name = lothlorien.17.a

		# Increase stability and consumer goods bonus
	}

	# The delegation is welcome to speak with our more experienced warriors. Elrond is too busy
	option = {
		ai_chance = {
			base = 1
		}
		trigger = {
			has_global_flag = lothlorien_16_response_b
		}
		name = lothlorien.17.b

		# Increase army xp bonus
	}
}

# maintain stability in the west event
country_event = {
	id = lothlorien.18
	title = lothlorien.18.t
	desc = lothlorien.18.d
	fire_only_once = yes

	is_triggered_only = yes

	# Stability is imperative, guarantee everyone
	option = {
		ai_chance = {
			base = 1
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}
		name = lothlorien.18.a

		every_country = {
			limit = {
				is_men = yes
				NOT = { tag = NEP }
				NOT = { belligerent > 0.45 }
				NOT = { revolutionary > 0.45 }
				NOT = { has_government = belligerent }
				NOT = { has_government = revolutionary }
				NOT = { is_in_faction = yes }
				NOT = { is_puppet = yes }
			}
			LTH = { give_guarantee = PREV }
		}
	}

	# opinion is enough
	option = {
		ai_chance = {
			base = 3
		}
		name = lothlorien.18.b

		every_country = {
			limit = {
				is_men = yes
				NOT = { tag = NEP }
				NOT = { belligerent > 0.45 }
				NOT = { revolutionary > 0.45 }
				NOT = { has_government = belligerent }
				NOT = { has_government = revolutionary }
				NOT = { is_in_faction = yes }
				NOT = { is_puppet = yes }
			}
			add_opinion_modifier = {
				target = LTH
				modifier = medium_increase
			}
		}
	}
}

# Cele and Gala BOTH leave for valinor
country_event = {
	id = lothlorien.19
	title = lothlorien.19.t
	desc = lothlorien.19.d
	fire_only_once = yes

	is_triggered_only = yes

	# Stability is imperative, guarantee everyone
	option = {
		ai_chance = {
			base = 1
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}
		name = lothlorien.19.a

		LTH_celeborn = {
			retire = yes
		}
		LTH_galadriel = {
			retire = yes
		}
	}
}

# Take Halflings to Valinor
country_event = {
	id = lothlorien.20
	title = lothlorien.20.t
	desc = lothlorien.20.d
	fire_only_once = yes

	is_triggered_only = yes

	# TODO: Have to come up with something here
	option = {
		ai_chance = {
			base = 1
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}
		name = lothlorien.20.a

		# Probably just add some flavour text to event-log
		# and give a newspaper event
	}
}

# Durins Bane Tracked Down
country_event = {
	id = lothlorien.21
	title = lothlorien.21.t
	desc = lothlorien.21.d
	fire_only_once = yes

	is_triggered_only = yes

	# TODO: Have to come up with something here
	option = {
		ai_chance = {
			base = 1
		}
		name = lothlorien.21.a

		# TODO
	}
}


