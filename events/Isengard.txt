###########################
# Isengard Events
###########################

add_namespace = isengard

# Meet with Gandalf
country_event = {
	id = isengard.1
	title = isengard.1.t
	desc = isengard.1.d
	picture = GFX_report_event_paper

	fire_only_once = yes

	is_triggered_only = yes

	option = { # Imprison him
		name = isengard.1.a
		ai_chance = {
			base = 65
			modifier = {
				add = -15
				MOR = { has_army_size = { size < 15 } }
			}
			modifier = {
				add = 25
				MOR = { has_army_size = { size > 20 } }
			}
		}

		# Adjust gameplan flag
		set_country_flag = gameplan_going_belligerent
		clr_country_flag = gameplan_going_cooperative

		add_ideas = ISE_commited_to_the_dark
		set_global_flag = gandalf_imprisoned

		# Complete focuses
		if = {
			limit = { 
				NOT = { 
					has_completed_focus = ISE_fate_of_isengard 
				} 
			}
			complete_national_focus = ISE_fate_of_isengard
		}
		if = {
			limit = { NOT = { has_completed_focus = ISE_ways_of_the_light } NOT = { has_completed_focus = ISE_ways_of_the_dark } }
			complete_national_focus = ISE_ways_of_the_dark
		}

		complete_national_focus = ISE_meet_with_gandalf
		complete_national_focus = ISE_imprison_gandalf

		hidden_effect = {news_event = { hours = 24 id = news.333 }}
	}
	option = { # Unite with him
		name = isengard.1.b
		ai_chance = {
			base = 15
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
			modifier = { factor = 0 is_going_cooperative = no }
		}
		add_timed_idea = {
			days = 365
			idea = ISE_commited_to_the_light
		}
		set_global_flag = gandalf_saruman_united

		# Adjust gameplan flag
		set_country_flag = gameplan_going_cooperative
		clr_country_flag = gameplan_going_belligerent

		# Complete focuses
		if = {
			limit = { NOT = { has_completed_focus = ISE_ways_of_the_light } NOT = { has_completed_focus = ISE_ways_of_the_dark } }
			complete_national_focus = ISE_ways_of_the_light
		}

		complete_national_focus = ISE_meet_with_gandalf
		complete_national_focus = ISE_unite_with_gandalf

		hidden_effect = {news_event = { hours = 24 id = news.334 }}
	}
}

# Shire requests joining hands
country_event = {
	id = isengard.2
	title = isengard.2.t
	desc = isengard.2.d
	picture = GFX_report_event_paper

	fire_only_once = yes

	is_triggered_only = yes

	option = { # Accept
		name = isengard.4.a
		ai_chance = {
			base = 30
			modifier = {
				add = 25
				ISE = { has_army_size = { size > 15 } }
			}
			modifier = {
				add = 100
				ENE = { has_government = belligerent }
			}
		}
		add_to_faction = SHI
		add_political_power = 50
		add_opinion_modifier = { target = SHI modifier = small_increase }
	}
	option = { # Demand puppet
		name = isengard.4.b
		ai_chance = {
			base = 50
			modifier = {
				any_other_country = {
					has_guaranteed = ENE
				}
				factor = 5
			}
			modifier = {
				add = 20
				ENE = { has_army_size = { size > 20 } }
			}
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}
		SHI = { country_event = shire.7 }
	}
	option = { # Refuse
		name = isengard.4.b
		ai_chance = {
			base = 50
			modifier = {
				any_other_country = {
					has_guaranteed = ENE
				}
				factor = 5
			}
			modifier = {
				add = 20
				ENE = { has_army_size = { size > 20 } }
			}
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}
		add_opinion_modifier = { target = SHI modifier = large_decrease }
		add_political_power = -25
	}
}

# Shire refuses to be a puppet
country_event = {
	id = isengard.3
	title = isengard.3.t
	desc = isengard.3.d
	picture = GFX_report_event_paper

	fire_only_once = yes

	is_triggered_only = yes

	option = {
		name = isengard.3.a
		add_opinion_modifier = { target = SHI modifier = large_decrease }
	}

}

# Shire accepts being a puppet
country_event = {
	id = isengard.4
	title = isengard.4.t
	desc = isengard.4.d
	picture = GFX_report_event_paper

	is_triggered_only = yes

	option = { # Accept
		name = isengard.4.a
 		puppet = SHI
		add_political_power = 50
	}
}

# Grima arrives in Isengard
country_event = {
	id = isengard.5
	title = isengard.5.t
	desc = isengard.5.d
	picture = GFX_report_event_paper

	fire_only_once = yes

	trigger = {
		tag = ISE
		has_global_flag = grima_exiled
		ISE = { has_government = belligerent }
	}

	mean_time_to_happen = {
		days = 30
	}

	option = {
		name = isengard.5.a

		add_advisor_role = {
		    character = ISE_grima
		    activate = yes
		    advisor = {
				idea_token = ISE_grima_chief_advisor
		        slot = chief_advisor
		        cost = 150
		        traits = {
		            corrupting_manipulator
		        }
		    }
		}

	}
}


#Saruman dies trigger
country_event = {
	id = isengard.1000
	hidden = yes

	fire_only_once = yes

	trigger = {
		has_global_flag = grima_exiled
		ISE = { surrender_progress > 0.5 }
	}

	immediate = {
		random_list = { 50 = { ISE = { country_event = { days = 1 id = isengard.6 } } } 50 = { } }
	}
}


# Saruman dies
country_event = {
	id = isengard.6
	title = isengard.6.t
	desc = isengard.6.d
	picture = GFX_report_event_paper

	fire_only_once = yes

	is_triggered_only = yes

	option = {
		name = isengard.6.a

		set_global_flag = saruman_dead

		ISE = {
			ISE_saruman = {
				lotr_kill_character = yes
			}
			remove_ideas = saruman_chief_researcher
			deactivate_advisor = ISE_grima_chief_advisor
			remove_advisor_role = {
	  			character = ISE_grima
	  			slot = chief_advisor
			}
		}

		news_event = { id = news.406 days = 2 }
	}
}

# Argonath raid (can also be triggered for Mordor)
country_event = {
	id = isengard.7
	title = isengard.7.t
	desc = isengard.7.d
	picture = GFX_report_event_ring
	
	is_triggered_only = yes

	# lets go
	option = {
		name = isengard.7.a
		ai_chance = { base = 100}

		add_political_power = -100
		if = {
			limit = { tag = ISE }
			ISE = {complete_national_focus = huntforthering }
		}

		set_country_flag = {
		    flag = is_argonath_raid
		    days = 30
		    value = 1
		}

		
		hidden_effect = {
			# If Rohan has secured the riddermark, this costs 20k manpower
			if = {
				limit = { tag = ISE ROH = { has_completed_focus = ROH_secure_the_riddermark NOT = { is_ally_with = ISE } } }
				add_manpower = -3000
			}

			# If Rohan is coordinationg with ISE, they get extra generals AND attacks
			if = {
				limit = { 
					tag = ISE
					ROH = { 
						has_country_flag = fs_rohan_coordinating_with_isengard
						OR = {
							ROH_habold = { is_unit_leader = yes }
							ROH_deorhelm = { is_unit_leader = yes }
							ROH_brego = { is_unit_leader = yes }
						}
					}
				}

				add_to_array = { global.fs_eventlog_prefix_targets = 0 }
				add_to_array = { global.fs_eventlog_suffix_targets = 0 }
				add_to_array = { global.fs_eventlog = token:fs_rohan_helps_at_argonath }
				ring_trim_eventlog = yes

				ROH = {
					if = {
						limit = { ROH_habold = { is_unit_leader = yes } }
						ROH_habold = { ring_add_member_to_hunting_party = yes }
						ISE = { ring_get_extra_1_attacks = yes }
					}
					if = {
						limit = { ROH_deorhelm = { is_unit_leader = yes } }
						ROH_deorhelm = { ring_add_member_to_hunting_party = yes }
						ISE = { ring_get_extra_1_attacks = yes }
					}
					if = {
						limit = { ROH_brego = { is_unit_leader = yes } }
						ROH_brego = { ring_add_member_to_hunting_party = yes }
						ISE = { ring_get_extra_1_attacks = yes }
					}
				}
			}
		}

		ring_open_interception_attempt_prompt = yes
	}

	# nah
	option = {
		name = isengard.7.b
		ai_chance = {
			base = 10
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}

		add_political_power = -100

		hidden_effect = {
			# if Mordor bad and exists -> run raid
			if = {
				limit = {
					tag = ISE
					country_exists = MOR
					NOT = { MOR = { is_subject = yes } }
				}
				MOR = { country_event = { id = isengard.7 days = 2 } }
			}

			else = {
				SHI = {
					ring_breakup_fellowship = yes
				}
			}
		}
	}
}

# Mordor invites Isengard to faction
country_event = {
	id = isengard.8
	title = isengard.8.t
	desc = isengard.8.d
	picture = GFX_report_event_ring

	is_triggered_only = yes

	# Accept
	option = {
		name = isengard.8.a
		ai_chance = {
			base = 25
			modifier = {
				add = 5
				has_non_aggression_pact_with = MOR
			}
			modifier = {
				add = 5
				OR = {
					has_war_with = GON
					has_war_with = ROH
				}
			}
			modifier = {
				add = 5
				has_opinion = {
					target = FROM
					value > 75
				}
			}
			modifier = {
				add = -999
				has_completed_focus = ISE_betray_sauron
			}
		}
		MOR = { 
			add_to_faction = ISE 
			country_event = { id =  mordor.69 } 
		}
	}
	#Decline
	option = {
		name = isengard.8.b
		ai_chance = {
			base = 50
			modifier = {
				add = 5
				has_opinion = {
					target = FROM
					value < 25
				}
			}
		}
		add_opinion_modifier = { target = MOR modifier = small_decrease }
		MOR = { 
			add_opinion_modifier = { target = ISE modifier = small_decrease } 
			country_event = { id = mordor.70 }
		}
	}
}

#Mordor innacts plan to attack Gondor together
country_event = {
	id = isengard.9
	title = isengard.9.t
	desc = isengard.9.d
	picture = GFX_report_event_ring

	is_triggered_only = yes

	option = {
		name = isengard.9.a
		ai_chance = {
			base = 50
			modifier = {
				add = -10
				has_war = yes
			}
		}
		add_war_support = 0.05
		declare_war_on = { target = GON    type = annex_everything }
	}

	option = {
		name = isengard.9.b
		ai_chance = { base = 5 }
		add_stability = -0.075
		add_political_power = -100
		complete_national_focus = ISE_betray_sauron
		MOR = { 
			add_opinion_modifier = { target = ISE modifier = large_decrease }
			country_event = { id = mordor.73 }
		}
	}
}

#Mordor demands puppeting
country_event = {
	id = isengard.10
	title = isengard.10.t
	desc = isengard.10.d
	picture = GFX_report_event_ring

	is_triggered_only = yes

	option = {
		name = isengard.10.a
		ai_chance = {
			base = 5
			modifier = {
				add = 5
				MOR = { has_same_ideology = yes }
			}
			modifier = {
				add = 5
				has_non_aggression_pact_with = MOR
			}
			modifier = {
				add = 10
				strength_ratio = { tag = MOR ratio > 0.75 }
			}
		}
		add_stability = -0.10
		MOR = {
			puppet = ISE
		}
	}

	option = {
		name = isengard.10.b
		ai_chance = {
			base = 25
			modifier = {
				add = 5
				is_in_faction = yes
				NOT = { is_in_faction_with = MOR }
			}
		}
		add_stability = 0.10
		add_war_support = 0.10
		add_popularity = {
			ideology = belligerent
			popularity = -0.05
		}
		MOR = {
			create_wargoal = {
				type = annex_everything target = ISE
			}
		}
	}
}

# Fellowship crossing mountains
country_event = {
	id = isengard.11
	title = isengard.11.t
	desc = isengard.11.d
	picture = GFX_report_event_ring

	is_triggered_only = yes

	# block path
	option = {
		name = isengard.11.a
		ai_chance = {
			base = 80
		}
		
		custom_effect_tooltip = isengard.11.a.tt

		hidden_effect = { SHI = { execute_force_fellowship_through_moria = yes } }
	}

	# let them pass
	option = {
		name = isengard.11.b
		ai_chance = {
			base = 10
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}
		
		custom_effect_tooltip = isengard.11.b.tt
	}
}

# Angmar (with Sauron as leader) invites Isengard to faction
country_event = {
	id = isengard.12
	title = isengard.12.t
	desc = isengard.12.d
	picture = GFX_report_event_ring

	is_triggered_only = yes

	option = {
		name = isengard.12.a
		ai_chance = {
			factor = 3
		}
		MOR = {
			add_to_faction = ISE
		}
	}

	option = {
		name = isengard.12.b
	}
}


# The Kingdom of Gondor requests if Isengard will join as a fiefdom 
country_event = {
	id = isengard.13
	title = isengard.13.t
	desc = isengard.13.d
	picture = GFX_report_event_ring

	is_triggered_only = yes

	option = {
		name = isengard.13.a
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				has_government = belligerent
			}
			modifier = {
				factor = 3
				has_government = cooperative
				GON = { has_government = cooperative }
			}
		}
		GON = {
			set_autonomy = {
				target = ISE
				autonomy_state = autonomy_fiefdom
			}
		}
	}

	option = {
		name = isengard.13.b
		ai_chance = {
			factor = 10
		}
		GON = {
			add_opinion_modifier = { target = ISE modifier = large_decrease }
		}
	}
}

# Request for help in their civil war
country_event = {
	id = isengard.14
	title = isengard.14.t
	desc = isengard.14.d
	picture = GFX_report_event_ring

	is_triggered_only = yes

	option = { #helping out
		name = isengard.14.a
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				has_government = belligerent
			}
			modifier = {
				factor = 3
				has_government = cooperative
				GON = { has_government = cooperative }
			}
		}
		random_other_country = {
			limit = {
				OR = {
					AND = {
						original_tag = ENE
						has_war = yes
						NOT = { has_government = belligerent }
					}
					AND = {
						original_tag = DUN
						has_war = yes
						NOT = { has_government = belligerent }
					}
				}
			}
			ISE = {
				declare_war_on = {
					target = PREV
					type = annex_everything
				}
			}
		}
	}

	option = { #refusing to help
		name = isengard.14.b
		ai_chance = {
			factor = 10
		}
		
	}
}

# Entwood agrees to expand relations
country_event = {
	id = isengard.15
	title = isengard.15.t
	desc = isengard.15.d
	picture = GFX_report_event_paper

	is_triggered_only = yes

	option = {
		name = isengard.15.a
		ISE = {
			add_opinion_modifier = { target = ENT modifier = small_increase } 
		}
	}
}

# Entwood refuses to expand relations
country_event = {
	id = isengard.16
	title = isengard.16.t
	desc = isengard.16.d
	picture = GFX_report_event_paper

	is_triggered_only = yes

	option = {
		name = isengard.16.a
		add_opinion_modifier = { target = ENT modifier = small_decrease } 
	}
}

# Mordor agrees to help incase of a battle in the Shire
country_event = {
	id = isengard.17
	title = isengard.17.t
	desc = isengard.17.d
	picture = GFX_report_event_paper

	is_triggered_only = yes

	option = {
		name = isengard.17.a
		add_political_power = 50
		add_opinion_modifier = { target = MOR modifier = small_increase } 
	}
}

# Mordor refuses to help incase of a battle in the Shire
country_event = {
	id = isengard.18
	title = isengard.18.t
	desc = isengard.18.d
	picture = GFX_report_event_paper

	is_triggered_only = yes

	option = {
		name = isengard.18.a
		add_opinion_modifier = { target = MOR modifier = small_decrease } 
	}
}

# Sending help
country_event = {
	id = isengard.19
	title = isengard.19.t
	desc = isengard.19.d
	picture = GFX_report_event_paper

	is_triggered_only = yes

	option = {
		name = isengard.19.a
		add_opinion_modifier = { target = ISE modifier = small_increase }
		add_ideas = ISE_supporting_country
	}
}

# Rohan accepts sharing knowledge
country_event = {
	id = isengard.20
	title = isengard.20.t
	desc = isengard.20.d
	picture = GFX_report_event_paper

	is_triggered_only = yes

	option = {
		name = isengard.20.a
		add_ideas = ISE_rohirrim_knowledge
		add_opinion_modifier = { target = ROH modifier = small_increase } 
	}
}

# Rohan declines sharing knowledge
country_event = {
	id = isengard.21
	title = isengard.21.t
	desc = isengard.21.d
	picture = GFX_report_event_paper

	is_triggered_only = yes

	option = {
		name = isengard.21.a
		add_opinion_modifier = { target = ROH modifier = small_decrease } 
	}
}

# Isengard investing efforts
country_event = {
	id = isengard.22
	title = isengard.22.t
	desc = isengard.22.d
	picture = GFX_report_event_paper

	is_triggered_only = yes

	option = {
		name = isengard.22.a
		add_popularity = { ideology = cooperative popularity = 0.075 }
		add_timed_idea = { days = 150 idea = ISE_isengard_investments }
		add_opinion_modifier = { target = ISE modifier = small_increase }
	}
}

# Suggest declaring war on Gondor
country_event = {
	id = isengard.23
	title = isengard.23.t
	desc = isengard.23.d
	picture = GFX_report_event_paper
	is_triggered_only = yes

	#Accept
	option = {
		name = isengard.23.a
		ai_chance = {
			base = 50
			modifier = {
				add = 5
				has_opinion = { target = MOR value > 75 }
			}
			modifier = {
				add = 5
				GON = { has_completed_focus = GON_honor_isildurs_legacy }
			}
		}
		set_country_flag = ISE_accepted_joined_war_against_gondor
		MOR = { 
			country_event = { id = mordor.71 } 
			add_opinion_modifier = { target = ISE modifier = small_increase } 
		}
	}
	#Decline
	option = {
		name = isengard.23.b
		ai_chance = {
			base = 25
		}
		MOR = { 
			add_opinion_modifier = { target = ISE modifier = small_decrease } 
			country_event = { id = mordor.72 }
		}
	}
}

# Mordor suggest non-aggresion pact
country_event = {
	id = isengard.24
	title = isengard.24.t
	desc = isengard.24.d
	picture = GFX_report_event_ring

	is_triggered_only = yes

	option = {
		name = isengard.24.a
		ai_chance = {
			base = 50
			modifier = {
				add = 25
				ISE = { has_government = belligerent }
			}
			modifier = {
				add = -999
				ISE = { has_government = cooperative }
			}
		}
		diplomatic_relation = {
			country = MOR
			relation = non_aggression_pact
		}
		MOR = { country_event = { id = mordor.69 } }
	}

	option = {
		name = isengard.24.b
		ai_chance = {
			base = 25
		}
		MOR = { 
			country_event = { id = mordor.70 } 
			add_opinion_modifier = { target = ISE modifier = small_decrease }
		}
	}
}

# Mordor fucks with the Palantir
country_event = {
	id = isengard.25
	title = isengard.25.t
	desc = isengard.25.d
	picture = GFX_report_event_ring

	is_triggered_only = yes

	option = {
		name = isengard.25.a
		ai_chance = { base = 50 }
		ISE = { 
			palantir_increase = yes 
			add_opinion_modifier = { target = MOR modifier = small_increase }
		}
	}
}