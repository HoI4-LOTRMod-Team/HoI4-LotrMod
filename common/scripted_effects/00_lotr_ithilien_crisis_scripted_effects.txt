

# Happens when mordor does the Ithilien crisis focus. Scope is MOR
ithc_commence_ithilien_crisis = {
	set_global_flag = ithc_ithilien_crisis_commenced
}

# Happens when GON and MOR got to war. Runs on no scope in particular
ithc_end_ithilien_crisis = {
	clr_global_flag = ithc_ithilien_crisis_commenced

	# Add the cores back that were removed
	22 = { add_core_of = GON }
	175 = { add_core_of = GON }
	173 = { add_core_of = GON }
	135 = { add_core_of = GON }
}


# THIS is the state to run effects on.
ithc_on_war_with_mordor_effects = {

	ithc_end_ithilien_crisis = yes

	if = {
		limit = { has_state_flag = ithc_infrastructure_sabotaged }
		ithc_subterfuge_sabotage_infrastructure_on_war = yes
	}
	if = {
		limit = { has_state_flag = ithc_defenses_located }
		ithc_subterfuge_locate_defenses_on_war = yes
	}
	if = {
		limit = { has_state_flag = ithc_hidden_weapon_caches }
		ithc_subterfuge_hide_weapon_caches_on_war = yes
	}
	if = {
		limit = { has_state_flag = ithc_sleeper_cells_planted }
		ithc_subterfuge_plant_sleeper_cells_on_war = yes
	}
}


# MOR contests a state -> Gon looses core and she shitshow begins
ithc_contest_state = {

	remove_core_of = GON
	set_compliance = 80
	set_resistance = 0

	set_state_flag = ithc_contested

	set_variable = { ithc_gondor_control = 4 }

	ithc_subterfuge_enable_new_decision = yes
	ithc_pillage_enable_new_decision = yes
}


# Will make a new subterfuge deicion available for MOR in this state
ithc_subterfuge_enable_new_decision = {
	
	random_list = {
		1 = {
			set_state_flag = ithc_subterfuge_gather_intelligence_enabled
		}
		1 = {
			modifier = {
				factor = 0
				has_state_flag = ithc_infrastructure_sabotaged
			}
			set_state_flag = ithc_subterfuge_sabotage_infrastructure_enabled
		}
		1 = {
			modifier = {
				factor = 0
				has_state_flag = ithc_defenses_located
			}
			set_state_flag = ithc_subterfuge_locate_defenses_enabled
		}
		1 = {
			modifier = {
				factor = 0
				has_state_flag = ithc_hidden_weapon_caches
			}
			set_state_flag = ithc_subterfuge_hide_weapon_caches_enabled
		}
		1 = {
			modifier = {
				factor = 0
				has_state_flag = ithc_sleeper_cells_planted
			}
			set_state_flag = ithc_subterfuge_plant_sleeper_cells_enabled
		}
	}
}


# Will make a new pillage deicion available for MOR in this state
ithc_pillage_enable_new_decision = {
	
	random_list = {
		1 = {
			set_state_flag = ithc_pillage_ambush_the_garrison_enabled
		}
		1 = {
			modifier = {
				factor = 0
				has_state_flag = ithc_population_massacred
			}
			set_state_flag = ithc_pillage_massacre_the_population_enabled
		}
		1 = {
			modifier = {
				factor = 0
				has_state_flag = ithc_layed_waste
			}
			set_state_flag = ithc_pillage_lay_waste_enabled
		}
		1 = {
			modifier = {
				factor = 0
				has_state_flag = ithc_plundered
			}
			set_state_flag = ithc_pillage_plunder_enabled
		}
		1 = {
			modifier = {
				factor = 0
				has_state_flag = ithc_fields_burned
			}
			set_state_flag = ithc_pillage_burn_and_sear_the_fields_enabled
		}
	}
}


ithc_begin_subterfuge_decision = {
	set_state_flag = ithc_subterfuge_operation
	subtract_from_variable  = { ithc_gondor_control = 1 }
}

ithc_begin_pillage_decision = {
	set_state_flag = ithc_pillage_operation
	subtract_from_variable  = { ithc_gondor_control = 1 }
}



ithc_subterfuge_sabotage_infrastructure_on_war = {
	
	# damage infrastructure in state FROM
	# add a modifier to state FROM with
	# strat_redeployment disabled and lower speed
}

ithc_subterfuge_locate_defenses_on_war = {
	
	# add modifier to state FROM that lowers entrenchment and defense
}

ithc_subterfuge_hide_weapon_caches_on_war = {
	
	# add modifier to state FROM that gives bonus supplies to MOR
}

ithc_subterfuge_plant_sleeper_cells_on_war = {
	
	# Spawn divisions in state THIS
}



